{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { mapState } from \"vuex\";\nconst regexMail = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\nfunction existeDeja(tableau, mail) {\n  for (let i = 0; i < tableau.length; i++) {\n    if (tableau[i].email.toLowerCase() === mail.toLowerCase()) {\n      return true;\n    }\n  }\n  return false;\n}\nfunction checkEntries(tableau, email, password) {\n  for (let i = 0; i < tableau.length; i++) {\n    if (tableau[i][\"email\"].toLowerCase() === email.toLowerCase()) {\n      if (tableau[i][\"motDePasse\"] === password) {\n        let utilisateur = {\n          id: tableau[i][\"id\"],\n          raisonSociale: tableau[i][\"raisonSociale\"],\n          siret: tableau[i][\"siret\"],\n          adresse: tableau[i][\"adresse\"],\n          codePostal: tableau[i][\"codePostal\"],\n          ville: tableau[i][\"ville\"],\n          email: tableau[i][\"email\"],\n          motDePasse: tableau[i][\"motDePasse\"],\n          role: tableau[i][\"role\"]\n        };\n        localStorage.setItem(\"myIdentity\", JSON.stringify(utilisateur));\n        return \"Connected\";\n      } else {\n        return \"ErrorPassword\";\n      }\n    }\n  }\n  return \"UserNotExist\";\n}\nexport default {\n  data() {\n    return {\n      users: this.$store.state.listOfUsers,\n      connectUser: {},\n      error: \"\",\n      success: \"\",\n      textColor: \"\",\n      identite: \"guest\",\n      groupe: \"GUEST\",\n      openedModal: false,\n      msg: \"\",\n      validEmail: false\n    };\n  },\n  computed: {\n    ...mapState([\"listOfUsers\"])\n  },\n  methods: {\n    openModal() {\n      this.openedModal = !this.openedModal;\n    },\n    closeModal() {\n      this.openedModal = !this.openedModal;\n    },\n    verifEmail() {\n      if (regexMail.test(this.email2) && !existeDeja(this.users, this.email2)) {\n        this.msg = \"L'Email que vous avez saisi ne correspond à aucun compte. \\u274C\";\n        this.validEmail = false;\n      } else {\n        this.msg = \"\";\n        this.validEmail = true;\n      }\n    },\n    forgot() {\n      if (this.validEmail) {\n        this.success = \"Un Email avec un nouveau mot de passe ainsi que le lien pour l'activer vient de vous être envoyé.\";\n        this.textColor = \"green\";\n      }\n    },\n    login() {\n      if (checkEntries(this.users, this.connectUser.email, this.connectUser.motDePasse) === \"ErrorPassword\") {\n        this.error = \"Erreur : Ce mot de passe est erroné.\";\n        this.textColor = \"red\";\n      } else if (checkEntries(this.users, this.connectUser.email, this.connectUser.motDePasse) === \"UserNotExist\") {\n        this.error = \"Erreur : Ce compte utilisateur n'existe pas.\";\n        this.textColor = \"red\";\n      } else {\n        this.success = \"Connexion réussie.\";\n        this.textColor = \"green\";\n        this.identite = JSON.parse(localStorage.getItem(\"myIdentity\")).raisonSociale;\n        this.$store.commit(\"CHANGE_IDENTITY\", this.identite);\n        this.groupe = JSON.parse(localStorage.getItem(\"myIdentity\")).role;\n        this.$store.commit(\"CHANGE_GROUP\", this.groupe);\n\n        // Transmission du groupe de l'utilisateur dans App.vue\n        this.$emit(\"updateGroup\", this.groupe);\n\n        // Redirection vers l'accueil\n        setTimeout(() => this.$router.push({\n          path: \"/\"\n        }), 2000);\n      }\n    }\n  },\n  created() {\n    let identity = localStorage.getItem(\"myIdentity\");\n    if (identity) {\n      this.identite = JSON.parse(localStorage.getItem(\"myIdentity\")).raisonSociale;\n      this.$store.commit(\"CHANGE_IDENTITY\", this.identite);\n    }\n    let storedUsers = localStorage.getItem(\"users\");\n    if (storedUsers) {\n      this.users = JSON.parse(storedUsers);\n    } else {\n      localStorage.setItem(\"users\", JSON.stringify(this.users));\n    }\n  }\n};","map":{"version":3,"names":["mapState","regexMail","existeDeja","tableau","mail","i","length","email","toLowerCase","checkEntries","password","utilisateur","id","raisonSociale","siret","adresse","codePostal","ville","motDePasse","role","localStorage","setItem","JSON","stringify","data","users","$store","state","listOfUsers","connectUser","error","success","textColor","identite","groupe","openedModal","msg","validEmail","computed","methods","openModal","closeModal","verifEmail","test","email2","forgot","login","parse","getItem","commit","$emit","setTimeout","$router","push","path","created","identity","storedUsers"],"sources":["/workspaces/Projet-WebWares/src/views/LoginView.vue"],"sourcesContent":["<template>\r\n  <div v-if=\"identite === 'guest'\" class=\"connect\">\r\n    <h1>Connexion</h1>\r\n    <div v-if=\"error\">\r\n      <span :style=\"{ color: textColor }\">{{ error }}</span>\r\n    </div>\r\n    <form v-on:submit.prevent=\"login\">\r\n      <label for=\"email\">Email :</label>\r\n      <input\r\n        type=\"email\"\r\n        id=\"email\"\r\n        name=\"email\"\r\n        v-model=\"connectUser.email\"\r\n        placeholder=\"Veuillez saisir votre Email\"\r\n        required\r\n      />\r\n      <br /><br />\r\n      <label for=\"motDePasse\">Mot De Passe :</label>\r\n      <input\r\n        type=\"password\"\r\n        id=\"motDePasse\"\r\n        name=\"motDePasse\"\r\n        v-model=\"connectUser.motDePasse\"\r\n        placeholder=\"Veuillez saisir votre Mot De Passe\"\r\n        required\r\n      />\r\n      <br /><br /><br />\r\n      <input type=\"submit\" value=\"Se connecter\" />\r\n    </form>\r\n    <br /><br />\r\n    <a @click=\"openModal()\">Mot De Passe oublié</a>\r\n\r\n    <!-- MODAL  -->\r\n    <div class=\"modal\" v-if=\"openedModal\" v-cloak>\r\n      <div class=\"modal-content\">\r\n        <span class=\"close\" @click=\"closeModal\">X</span>\r\n        <div v-if=\"success === ''\">\r\n          <h2>Mot De Passe oublié</h2>\r\n          <form v-on:submit.prevent=\"forgot\">\r\n            <label for=\"email\">Email :</label>\r\n            <input\r\n              type=\"email\"\r\n              id=\"email2\"\r\n              name=\"email2\"\r\n              v-model=\"email2\"\r\n              style=\"width: 460px\"\r\n              placeholder=\"Veuillez saisir votre Email\"\r\n              @input=\"verifEmail\"\r\n              required\r\n            />\r\n            <span v-html=\"msg\" v-if=\"msg != ''\"></span>\r\n            <br /><br />\r\n            <p>\r\n              Un nouveau mot de passe ainsi que le lien pour l'activer vont être\r\n              envoyés à cette adresse.\r\n            </p>\r\n            <br />\r\n            <input type=\"submit\" value=\"Envoyer l'email\" />\r\n          </form>\r\n        </div>\r\n        <div v-else>\r\n          <span :style=\"{ color: textColor }\"><br />{{ success }}</span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <!-- MODAL  -->\r\n  </div>\r\n  <div v-else class=\"connect\">\r\n    <div v-if=\"success\">\r\n      <span :style=\"{ color: textColor }\"><br />{{ success }}</span>\r\n      <br /><br />\r\n      Bonjour <b>{{ identite }}</b> <br /><br />\r\n      Redirection en cours ...\r\n    </div>\r\n    <div v-else>\r\n      <br />\r\n      Vous êtes déjà connecté sous l'identité <b>{{ identite }}</b>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { mapState } from \"vuex\";\r\n\r\nconst regexMail = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n\r\nfunction existeDeja(tableau, mail) {\r\n  for (let i = 0; i < tableau.length; i++) {\r\n    if (tableau[i].email.toLowerCase() === mail.toLowerCase()) {\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\nfunction checkEntries(tableau, email, password) {\r\n  for (let i = 0; i < tableau.length; i++) {\r\n    if (tableau[i][\"email\"].toLowerCase() === email.toLowerCase()) {\r\n      if (tableau[i][\"motDePasse\"] === password) {\r\n        let utilisateur = {\r\n          id: tableau[i][\"id\"],\r\n          raisonSociale: tableau[i][\"raisonSociale\"],\r\n          siret: tableau[i][\"siret\"],\r\n          adresse: tableau[i][\"adresse\"],\r\n          codePostal: tableau[i][\"codePostal\"],\r\n          ville: tableau[i][\"ville\"],\r\n          email: tableau[i][\"email\"],\r\n          motDePasse: tableau[i][\"motDePasse\"],\r\n          role: tableau[i][\"role\"],\r\n        };\r\n        localStorage.setItem(\"myIdentity\", JSON.stringify(utilisateur));\r\n        return \"Connected\";\r\n      } else {\r\n        return \"ErrorPassword\";\r\n      }\r\n    }\r\n  }\r\n  return \"UserNotExist\";\r\n}\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      users: this.$store.state.listOfUsers,\r\n      connectUser: {},\r\n      error: \"\",\r\n      success: \"\",\r\n      textColor: \"\",\r\n      identite: \"guest\",\r\n      groupe: \"GUEST\",\r\n      openedModal: false,\r\n      msg: \"\",\r\n      validEmail: false,\r\n    };\r\n  },\r\n\r\n  computed: {\r\n    ...mapState([\"listOfUsers\"]),\r\n  },\r\n\r\n  methods: {\r\n    openModal() {\r\n      this.openedModal = !this.openedModal;\r\n    },\r\n\r\n    closeModal() {\r\n      this.openedModal = !this.openedModal;\r\n    },\r\n\r\n    verifEmail() {\r\n      if (regexMail.test(this.email2) && !existeDeja(this.users, this.email2)) {\r\n        this.msg =\r\n          \"L'Email que vous avez saisi ne correspond à aucun compte. \\u274C\";\r\n        this.validEmail = false;\r\n      } else {\r\n        this.msg = \"\";\r\n        this.validEmail = true;\r\n      }\r\n    },\r\n\r\n    forgot() {\r\n      if (this.validEmail) {\r\n        this.success =\r\n          \"Un Email avec un nouveau mot de passe ainsi que le lien pour l'activer vient de vous être envoyé.\";\r\n        this.textColor = \"green\";\r\n      }\r\n    },\r\n\r\n    login() {\r\n      if (\r\n        checkEntries(\r\n          this.users,\r\n          this.connectUser.email,\r\n          this.connectUser.motDePasse\r\n        ) === \"ErrorPassword\"\r\n      ) {\r\n        this.error = \"Erreur : Ce mot de passe est erroné.\";\r\n        this.textColor = \"red\";\r\n      } else if (\r\n        checkEntries(\r\n          this.users,\r\n          this.connectUser.email,\r\n          this.connectUser.motDePasse\r\n        ) === \"UserNotExist\"\r\n      ) {\r\n        this.error = \"Erreur : Ce compte utilisateur n'existe pas.\";\r\n        this.textColor = \"red\";\r\n      } else {\r\n        this.success = \"Connexion réussie.\";\r\n        this.textColor = \"green\";\r\n\r\n        this.identite = JSON.parse(\r\n          localStorage.getItem(\"myIdentity\")\r\n        ).raisonSociale;\r\n        this.$store.commit(\"CHANGE_IDENTITY\", this.identite);\r\n\r\n        this.groupe = JSON.parse(localStorage.getItem(\"myIdentity\")).role;\r\n        this.$store.commit(\"CHANGE_GROUP\", this.groupe);\r\n\r\n        // Transmission du groupe de l'utilisateur dans App.vue\r\n        this.$emit(\"updateGroup\", this.groupe);\r\n\r\n        // Redirection vers l'accueil\r\n        setTimeout(() => this.$router.push({ path: \"/\" }), 2000);\r\n      }\r\n    },\r\n  },\r\n\r\n  created() {\r\n    let identity = localStorage.getItem(\"myIdentity\");\r\n    if (identity) {\r\n      this.identite = JSON.parse(\r\n        localStorage.getItem(\"myIdentity\")\r\n      ).raisonSociale;\r\n\r\n      this.$store.commit(\"CHANGE_IDENTITY\", this.identite);\r\n    }\r\n\r\n    let storedUsers = localStorage.getItem(\"users\");\r\n    if (storedUsers) {\r\n      this.users = JSON.parse(storedUsers);\r\n    } else {\r\n      localStorage.setItem(\"users\", JSON.stringify(this.users));\r\n    }\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.connect {\r\n  width: 600px;\r\n  margin-left: auto;\r\n  margin-right: auto;\r\n  border: 1px solid rgb(231, 67, 39);\r\n  padding: 10px 40px 30px 20px;\r\n}\r\n\r\nlabel {\r\n  float: left;\r\n  font-weight: bold;\r\n}\r\n\r\ninput {\r\n  width: 100%;\r\n  padding: 10px;\r\n  border: none;\r\n  border-bottom: 1px solid rgb(231, 67, 39);\r\n}\r\n\r\ninput[type=\"submit\"] {\r\n  width: unset;\r\n  padding: 5px 15px;\r\n  color: #fff;\r\n  font-weight: bold;\r\n  cursor: pointer;\r\n  border-radius: 5px;\r\n  background-color: rgb(231, 67, 39);\r\n}\r\n\r\na {\r\n  text-decoration: underline;\r\n  cursor: pointer;\r\n}\r\n\r\na:hover {\r\n  color: rgb(231, 67, 39);\r\n}\r\n\r\n.modal {\r\n  display: flex;\r\n  position: fixed;\r\n  top: 50%;\r\n  left: 50%;\r\n  transform: translate(-50%, -50%);\r\n  width: 100%;\r\n  height: 100%;\r\n  background-color: rgba(0, 0, 0, 0.5);\r\n  z-index: 1;\r\n  justify-content: center;\r\n  align-items: center;\r\n}\r\n\r\n.modal-content {\r\n  background-color: white;\r\n  padding: 20px;\r\n  border-radius: 5px;\r\n  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);\r\n  max-width: 500px;\r\n  width: 100%;\r\n  position: relative;\r\n}\r\n\r\n.close {\r\n  position: absolute;\r\n  top: 10px;\r\n  right: 10px;\r\n  cursor: pointer;\r\n  font-size: 18px;\r\n  color: #333;\r\n  z-index: 2;\r\n}\r\n\r\n[v-cloak] {\r\n  display: none;\r\n}\r\n\r\n@media screen and (max-width: 400px) {\r\n  .connect {\r\n    width: 300px;\r\n  }\r\n}\r\n</style>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}